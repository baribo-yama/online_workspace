# BUGS.md — MOKU

## バグ管理ルール
- バグは「未修正」と「修正済み」に分けて記録する。  
- 修正後は必ず「原因」と「再発防止策」を追記する。  
- 軽微なUIバグやパフォーマンス低下も、再発性がある場合は記録対象に含める。  
- AIに読み込ませる際は、「再発防止メモを考慮して修正案を出す」と指示する。

---

## 未修正（Open）

### B001 — 部屋の人数制限が機能していない
**発生日:** 2025-10-19  
**優先度:** 高  
**状況:** 調査中  
**概要:**  
- 一部屋あたり5人までに制限したいが、現状は制限なし。  
- テスト運用では最大10人を想定している。  

**仮説・原因:**  
- FirestoreまたはLiveKitのルーム作成時に `maxParticipants` の制御が行われていない。  

**改善案:**  
- ルーム作成時に人数上限を `constants.js` で定義し、Firestoreに保持。  
- UIにも「定員に達しました」アラートを追加する。  

---

### B002 — 入室時に参加者リスト（participantList）が更新されない
**発生日:** 2025-10-19  
**優先度:** 高  
**状況:** 調査中  
**概要:**  
- 入室しても参加者リストに名前が追加されないことがある。  
- リロードすると反映される。  

**仮説・原因:**  
- LiveKitの `participantConnected` イベントが遅延または失敗している。  
- 通信速度や呼び出し順に依存している可能性あり。  

**改善案:**  
- `onTrackSubscribed` や `participantConnected` イベントを監視し、同期を明示的に再実行。  
- 再接続時にイベントリスナーが二重登録されないよう、`cleanup` 関数を導入。  

---

## 修正済み（Closed）

*(まだ登録なし)*

---

## 再発防止メモ
- **人数制限ロジック:**  
  定数として人数上限を管理し、ルーム作成時とUI表示時で共通利用する。  
  例：`MAX_PARTICIPANTS = 5` を `constants.js` に保持。  

- **LiveKit参加者リスト:**  
  イベントの非同期性を考慮し、`useEffect` の依存配列やリスナー解除を徹底する。  
  テスト時には通信遅延をシミュレートして再現性を確認する。  

---

## 新規バグ登録テンプレート

### BXXX — [タイトル]
**発生日:** YYYY-MM-DD  
**優先度:** 高 / 中 / 低  
**状況:** 調査中 / 修正中 / 保留 / 完了  

**概要:**  
（現象の説明）

**仮説・原因:**  
（技術的な推定）

**改善案:**  
（修正の方向性）



