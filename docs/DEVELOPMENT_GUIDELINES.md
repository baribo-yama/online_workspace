# 開発ガイドライン — MOKU

## 目的
このドキュメントは、MOKUプロジェクトにおける開発ルールと運用方針を定義し、  
チーム開発とAI支援開発の品質を統一することを目的とする。

---

## 🚫 禁止事項

### **UI・機能追加時の必須確認**
新しいUIや機能を追加する場合は、**必ず事前に確認を取ること**。

#### **確認が必要な項目**
- [ ] ユーザーからの明示的な要求があるか
- [ ] 既存機能との重複がないか
- [ ] アーキテクチャに適合するか
- [ ] パフォーマンスに影響しないか
- [ ] 保守性を損なわないか

#### **確認プロセス**
1. **ユーザーへの確認**: 新しいUIや機能の追加前に必ず確認
2. **設計レビュー**: アーキテクチャに適合するかチェック
3. **実装**: 承認後に実装開始
4. **テスト**: 動作確認とドキュメント更新

---

## 📋 開発ルール

### **1. ファイルサイズ制限**
- **1ファイル200行以下**: 超過時は責務単位で分割
- **コンポーネント**: 単一責務の原則
- **カスタムフック**: 特定の機能に特化

### **2. コード品質**
- **linterエラー**: ゼロエラー必須
- **未使用コード**: 即座に削除
- **命名規則**: CODING_RULES.mdに準拠

### **3. アーキテクチャ準拠**
- **Feature-Based Architecture**: 機能単位での整理
- **UI/ロジック分離**: コンポーネントは表示専用
- **カスタムフック**: ロジック層の分離

---

## 🔧 技術的制約

### **LiveKit設定**
- **サーバーURL**: HTTPSプロトコルを使用
- **WebSocket**: 適切なプロトコル設定
- **トークン生成**: セキュアな実装

### **エラーハンドリング**
- **ユーザーフレンドリー**: 技術的詳細を隠す
- **適切なフォールバック**: エラー時の代替手段
- **ログ出力**: デバッグ情報の適切な管理

---

## 🚨 よくある問題と対処法

### **問題1: WSS URLエラー**
```
Fetch API cannot load wss://... URL scheme "wss" is not supported.
```

**原因**: WebSocket URLをHTTPのFetch APIで使用  
**対処法**: HTTPSプロトコルに変更

```javascript
// ❌ 間違い
serverUrl: 'wss://example.livekit.cloud'

// ✅ 正しい
serverUrl: 'https://example.livekit.cloud'
```

### **問題2: 不要なUI追加**
**症状**: ユーザーが要求していないUIが追加される  
**対処法**: 事前確認プロセスの徹底

### **問題3: 未使用コードの蓄積**
**症状**: linterエラー、コードの肥大化  
**対処法**: 定期的なクリーンアップ

---

## 📝 ドキュメント管理

### **必須ドキュメント**
- **バグ修正**: `docs/bug-fixes/YYYY-MM-DD_description.md`
- **リファクタリング**: `docs/refactoring-reports/YYYY-MM-DD_description.md`
- **新機能**: `docs/feature-reports/YYYY-MM-DD_description.md`

### **ドキュメントテンプレート**
- [REFACTORING_REPORT.md](./templates/REFACTORING_REPORT.md)
- [BUG_FIX_REPORT.md](./templates/BUG_FIX_REPORT.md)

---

## 🤖 AI支援開発のルール

### **AIへの指示時の必須項目**
1. **目的の明確化**: 何を実現したいか
2. **制約の明示**: 既存機能への影響
3. **確認の要求**: UI追加時の事前確認
4. **ドキュメント更新**: 変更内容の記録

### **AIがしてはいけないこと**
- ❌ ユーザーが要求していないUIの追加
- ❌ 既存機能の無断変更
- ❌ アーキテクチャに反する実装
- ❌ ドキュメントなしの変更

### **AIがすべきこと**
- ✅ ユーザーの明示的な要求の実装
- ✅ 既存ルールの遵守
- ✅ 適切なドキュメント作成
- ✅ 事前確認の徹底

---

## 🔄 継続的改善

### **定期チェック項目**
- [ ] ファイルサイズの監視
- [ ] linterエラーの解消
- [ ] 未使用コードの削除
- [ ] ドキュメントの更新

### **品質向上の取り組み**
- **コードレビュー**: 定期的な品質チェック
- **リファクタリング**: 技術的負債の解消
- **テスト**: 機能の動作確認

---

## 📞 連絡・確認事項

### **確認が必要な場合**
新しいUIや機能の追加を検討する際は、必ずユーザーに確認を取ってください。

### **緊急時の対応**
- **重大なバグ**: 即座に修正
- **セキュリティ問題**: 最優先で対応
- **機能停止**: 緊急修正の実施

---

## 更新履歴

- **2025-10-19**: 初版作成（AI支援開発ルールの確立）
- **2025-10-19**: UI追加時の確認プロセス追加
- **2025-10-19**: 技術的制約と対処法を追加

---

## 関連ドキュメント

- [ARCHITECTURE.md](./ARCHITECTURE.md) - アーキテクチャ設計
- [CODING_RULES.md](./CODING_RULES.md) - コーディング規約
- [AI_GUIDELINES.md](./AI_GUIDELINES.md) - AI支援開発ガイドライン
